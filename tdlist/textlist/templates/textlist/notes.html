{% extends 'textlist/base.html' %}
{% load static %}

{% block content %}

<div class="main-container">

    <div class="days-of-week">
        <ul class="listdo">
            <a href="{% url 'notes' '1'%}" id="day_of_week_1"><li class="dolist-element todl-bet">ПН</li></a>
            <a href="{% url 'notes' '2'%}" id="day_of_week_2"><li class="dolist-element todl-bet">ВТ</li></a>
            <a href="{% url 'notes' '3'%}" id="day_of_week_3"><li class="dolist-element todl-bet">СР</li></a>
            <a href="{% url 'notes' '4'%}" id="day_of_week_4"><li class="dolist-element todl-bet">ЧТ</li></a>
            <a href="{% url 'notes' '5'%}" id="day_of_week_5"><li class="dolist-element todl-bet">ПТ</li></a>
            <a href="{% url 'notes' '6'%}" id="day_of_week_6"><li class="dolist-element todl-bet">СБ</li></a>
            <a href="{% url 'notes' '7'%}" id="day_of_week_7"><li class="dolist-element todl-bet">НД</li></a>
        </ul>
    </div>
    <div class="vertical-block1">
        <a href="{% url 'create_note' week_day %}">
        <button class="vertical-block-todo plus" id="new_note_button">
            <img src="{% static 'textlist/images/plus.svg' %}" class="plus1">
        </button>
        </a>
    <div class="container-vertical" id = "all_notes">
        {% for note in all_cust_note %}
            {% if note.day_of_week == week_day %}          <!--День тижня-->
                <div id = "notes_block">
            <div class="vertical-block-todo" >
                <div class="right-side-button">
                    <input type="time" id="note_time_{{ note.pk }}" name="time" class="title-time" value="{{ note.time_note }}"
                        pattern="[0-2][0-9]:[0-5][0-9]" readonly/>
                    <div>
                        <button class="refactor-buttons" id="t_{{note.pk}}"><img
                                src="{% static 'textlist/images/telegram.svg' %}" class="telegram-button"></button>
                        <a href="{% url 'delete_note' note.pk %}"><button class="refactor-buttons" id="d_{{note.pk}}"><img
                                src="{% static 'textlist/images/delete_button.svg' %}" class="telegram-button" onclick="deleteNote('{{note.pk}}')"></button></a>
                        <a href="{% url 'refactor_note' note.pk %}"><button class="refactor-buttons" id="e_{{note.pk}}" onclick="toggleContentEditable('{{note.pk}}')">
                            <img src="{% static 'textlist/images/editing.svg' %}" class="telegram-button"></button></a>
                    </div>
                </div>
                <div class="line-from-todo-det"></div>
                <div class="title-text" contenteditable="false" id="title_text_{{note.pk}}">{{note.title_note}}</div>
                <div class="line-from-todo-det-under-title"></div>
                <div class="todotext" contenteditable="false" id="text_note_{{note.pk}}">{{ note.text_note }}</div>
            </div>
                </div>
            {% endif %}
        {% endfor %}


    </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>

    function toggleContentEditable(noteId) {
        let titleTextElement = document.getElementById("title_text_" + noteId);
        let TextNoteElement = document.getElementById("text_note_" + noteId);
        let TimeNoteElement = document.getElementById('note_time_' + noteId);
        console.log(TimeNoteElement);
        let editButton = document.getElementById("e_" + noteId).querySelector("img");
        if (titleTextElement.contentEditable === "true") {

            var title_text_up = $('#title_text_' + noteId).html();
            var text_note_up = $('#text_note_' + noteId).html();
            var getTime = document.getElementById('note_time_' + noteId).value;
            console.log(title_text_up + "     " + text_note_up + "     " + getTime);
            $.ajax({
                type: 'POST',
                url: '/refactor_note/' + noteId + "/",
                data: {
                    'note_id': noteId,
                    'title_text_up': title_text_up,
                    'text_note_up': text_note_up,
                    'getTime': getTime,
                    'csrfmiddlewaretoken': '{{ csrf_token }}',
                },
                dataType: 'json',
                success: function (data){
                    titleTextElement.contentEditable = "false";
                    TextNoteElement.contentEditable = "false";
                    TimeNoteElement.setAttribute('readonly', 'false');
                    // Змінити зображення, коли режим редагування вимкнено
                    editButton.src = "{%  static 'textlist/images/editing.svg' %}";
                }
            });


        }
        else {
            titleTextElement.contentEditable = "true";
            TextNoteElement.contentEditable = "true";
            TimeNoteElement.removeAttribute('readonly');
            // Змінити зображення, коли режим редагування увімкнено
            editButton.src = "{%  static 'textlist/images/save.svg' %}";
        }
    }


    function deleteNote(noteId) {
        var elementToDelete = document.getElementById("d_" + noteId).closest('.vertical-block-todo');

        $(elementToDelete).animate({ left: "300px", opacity: 0}, 600, function() {
            elementToDelete.remove();
        });
    }

    $(function(){
        $("#new_note_button").click(function(){
            let prevState = $("#all_notes").html();
            let newNote = `<div class="vertical-block-todo" >
                <div class="right-side-button">
                    <input type="time" id="time" name="time" class="title-time" value="00:00:00"
                        pattern="[0-2][0-9]:[0-5][0-9]" />
                    <div>
                        <button class="refactor-buttons" id="t_"><img
                                src="{% static 'textlist/images/telegram.svg' %}" class="telegram-button"></button>
                        <button class="refactor-buttons" id=""><img
                                src="{% static 'textlist/images/delete_button.svg' %}" class="telegram-button" onclick="deleteNote('{{note.pk}}')"></button>
                        <button class="refactor-buttons" id="e_" onclick="toggleContentEditable('')">
                            <img src="{% static 'textlist/images/editing.svg' %}" class="telegram-button"></button>
                    </div>
                </div>
                <div class="line-from-todo-det"></div>
                <div class="title-text" contenteditable="false" id="title_text_"></div>
                <div class="line-from-todo-det-under-title"></div>
                <div class="todotext" contenteditable="false" id="text_note_"></div></div>`;

           $('#all_notes').html(newNote + prevState);

        });

    });



</script>
{% endblock %}